import{E as _}from"./Events-fb55d1f4.js";import{B as x}from"./Buttons-e9a12f53.js";import{M as w,V as B}from"./Validates-7d06d876.js";import{S as i}from"./sweetalert2-374f0b4f.js";$(function(){const a=new _,c=new x,s=new w("branch-inventory-new-device-modal"),u=new B;let d=[];$("#new-device-model option").each(function(){d.push({id:$(this).val(),text:$(this).text(),subline:$(this).data("subline")})});let m=new URLSearchParams(window.location.search);v(m.get("device")),g(),c.initClic(".point-button",function(e){const t=e.data("point");r(t)}),c.initClic("#add-point-button",function(e){const t=e.data("service"),n=e.data("area");a.post("/api/v1/Support/Branch-Inventory/"+t+"/"+n,{api_key,_method:"PUT"},function(o){o.code==200?r(o.data.point):i.fire({text:o.message,icon:"error",confirmButtonText:"Aceptar"})},function(){i.fire({text:"Ha ocurrido un error al intentar crear el punto. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"})})}),$(".censo-model-list").on("change",function(){const e=$(this),t={service:e.data("service"),area:e.data("area"),point:e.data("point"),old_model:e.data("model"),id:e.data("id"),model:e.val()};if(t.model==""){i.fire({text:"Debe seleccionar un modelo.",icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_model).trigger("change");return}t.model!=t.old_model&&i.fire({title:"¿Continuar?",text:"Al cambiar el modelo se eliminarán todas las características y accesorios del equipo",icon:"warning",showCancelButton:!0,confirmButtonText:"Actualizar",cancelButtonText:"Cancelar"}).then(n=>{n.isConfirmed?a.post("/api/v1/Support/Branch-Inventory/UpdateModel/"+t.id,{api_key,_method:"POST",model:t.model},function(o){o.code==200?(a.loading(),r(t.point,t.id)):(i.fire({text:o.message,icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_model).trigger("change"))},function(){i.fire({text:"Ha ocurrido un error al intentar actualizar el modelo del equipo. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_model).trigger("change")}):e.val(t.old_model).trigger("change")})}),$(".censo-serial").on("blur",function(){const e=$(this),t={point:e.data("point"),id:e.data("id"),old_serial:e.data("serial").toString().trim(),serial:e.val().toString().trim()};t.serial==""?i.fire({title:"¿Guardar?",text:"Si no se captura el número de serie, se guardará como 'ILEGIBLE'",icon:"warning",showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar"}).then(n=>{n.isConfirmed?p(e,t):e.val(t.old_serial)}):t.serial!=t.old_serial&&p(e,t)}),$(".censo-status").on("change",function(){const e=$(this),t={point:e.data("point"),id:e.data("id"),old_status:e.data("status"),status:e.val()};a.post("/api/v1/Support/Branch-Inventory/UpdateStatus/"+t.id,{api_key,_method:"POST",status:t.status},function(n){n.code!=200?(i.fire({text:n.message,icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_status).trigger("change")):t.status==17?e.closest(".device-card").removeClass("border-danger"):e.closest(".device-card").addClass("border-danger")},function(){i.fire({text:"Ha ocurrido un error al intentar actualizar el estado del equipo. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_status).trigger("change")})}),$(".censo-feature-value-list").on("change",function(){const e=$(this),t={api_key,_method:"POST",id:e.data("id"),feature:e.data("feature"),old_value:e.data("value"),value:e.find("option:selected").text().trim()};t.value==""&&t.old_value==""||a.post("/api/v1/Support/Branch-Inventory/UpdateFeatureValue/"+t.id,t,function(n){n.code!=200&&i.fire({text:n.message,icon:"error",confirmButtonText:"Aceptar"})},function(){i.fire({text:"Ha ocurrido un error al intentar actualizar la característica del equipo. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"})})}),$(".device-accesories").on("blur",function(){const e=$(this),t={api_key,_method:"POST",id:e.data("id"),component:e.data("component"),old_quantity:parseInt(e.data("quantity")),quantity:parseInt(e.val())};t.quantity!=t.old_quantity&&a.post("/api/v1/Support/Branch-Inventory/UpdateAccesory/"+t.id,t,function(n){n.code!=200&&(i.fire({text:n.message,icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_quantity))},function(){i.fire({text:"Ha ocurrido un error al intentar actualizar la cantidad del accesorio. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_quantity)})});function p(e,t){a.post("/api/v1/Support/Branch-Inventory/UpdateSerial/"+t.id,{api_key,_method:"POST",serial:t.serial},function(n){n.code==200?(a.loading(),r(t.point,t.id)):(i.fire({text:n.message,icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_serial))},function(){i.fire({text:"Ha ocurrido un error al intentar actualizar el número de serie del equipo. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_serial)})}function r(e,t=null){let n=window.location.href;const o=new URL(n);o.search="",o.hash="";let l=o.toString()+"?point="+e+(t?"&device="+t:"");window.location.href=l}function v(e){if(e&&$("#device-card-"+e).length>0){const t=$("#device-card-"+e).offset().top-100;window.scrollTo({top:t,behavior:"smooth"})}}function g(){$(".censo-model-list").select2({theme:"bootstrap-5"})}c.initClic("#new-device-form-button, .missing-subline-button",function(e){let t=e.data("subline")?e.data("subline"):null;f(t),s.show(),s.onhide(function(){f(t)}),c.initClic("#branch-inventory-new-device-button",function(n){if(u.form("#new-device-form")){const o={api_key,_method:"PUT",model:$("#new-device-model").val(),serial:$("#new-device-serial").val(),status:$("#new-device-status").val(),service:$("#new-device-service").val(),area:$("#new-device-area").val(),point:$("#new-device-point").val()};a.post("/api/v1/Support/Branch-Inventory/"+o.service+"/"+o.area+"/"+o.point+"/Device",o,function(l){l.code==200?r(o.point,l.data.device):i.fire({text:l.message,icon:"error",confirmButtonText:"Aceptar"})},function(){i.fire({text:"Ha ocurrido un error al intentar registrar el nuevo equipo. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"})})}})});function f(e=null){u.form_reset("#new-device-form"),h(e),$("#new-device-model").val("").trigger("change"),$("#new-device-serial").val(""),$("#new-device-status").val(17)}function h(e=null){$("#new-device-model option").remove();let t=d;e&&(t=d.filter(function(n){return n.subline==e})),$.each(t,function(n,o){$("#new-device-model").append("<option value='"+o.id+"' data-subline='"+o.subline+"' data-hide='0'>"+o.text+"</option>")}),$("#new-device-model").select2({theme:"bootstrap-5",dropdownParent:$("#branch-inventory-new-device-modal"),placeholder:"Seleccione un modelo"})}c.initClic(".censo-delete-device",function(e){i.fire({title:"¿Eliminar?",icon:"warning",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",html:"¿Está seguro de eliminar el equipo?<br><strong>Esta acción no se puede deshacer</strong>"}).then(t=>{if(t.isConfirmed){const n={api_key,_method:"DELETE"};a.post("/api/v1/Support/Branch-Inventory/Device/"+e.data("id"),n,function(o){o.code==200?r(e.data("point")):i.fire({text:o.message,icon:"error",confirmButtonText:"Aceptar"})},function(){i.fire({text:"Ha ocurrido un error al intentar eliminar el equipo. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"})})}})}),a.loaded()});
