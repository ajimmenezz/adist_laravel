import{E as g}from"./Events-89d9745c.js";import{B as h}from"./Buttons-e9a12f53.js";import{M as _,V as x}from"./Validates-7d06d876.js";import{s as o}from"./sweetalert2.all-92414cd4.js";$(function(){const i=new g,c=new h,l=new _("branch-inventory-new-device-modal"),d=new x;let p=new URLSearchParams(window.location.search);f(p.get("device")),m(),c.initClic(".point-button",function(e){const t=e.data("point");r(t)}),c.initClic("#add-point-button",function(e){const t=e.data("service"),n=e.data("area");i.post("/api/v1/Support/Branch-Inventory/"+t+"/"+n,{api_key,_method:"PUT"},function(a){a.code==200?r(a.data.point):o.fire({text:a.message,icon:"error",confirmButtonText:"Aceptar"})},function(){o.fire({text:"Ha ocurrido un error al intentar crear el punto. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"})})}),$(".censo-model-list").on("change",function(){const e=$(this),t={service:e.data("service"),area:e.data("area"),point:e.data("point"),old_model:e.data("model"),id:e.data("id"),model:e.val()};if(t.model==""){o.fire({text:"Debe seleccionar un modelo.",icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_model).trigger("change");return}t.model!=t.old_model&&o.fire({title:"¿Continuar?",text:"Al cambiar el modelo se eliminarán todas las características y accesorios del equipo",icon:"warning",showCancelButton:!0,confirmButtonText:"Actualizar",cancelButtonText:"Cancelar"}).then(n=>{n.isConfirmed?i.post("/api/v1/Support/Branch-Inventory/UpdateModel/"+t.id,{api_key,_method:"POST",model:t.model},function(a){a.code==200?(i.loading(),r(t.point,t.id)):(o.fire({text:a.message,icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_model).trigger("change"))},function(){o.fire({text:"Ha ocurrido un error al intentar actualizar el modelo del equipo. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_model).trigger("change")}):e.val(t.old_model).trigger("change")})}),$(".censo-serial").on("blur",function(){const e=$(this),t={point:e.data("point"),id:e.data("id"),old_serial:e.data("serial").toString().trim(),serial:e.val().toString().trim()};t.serial==""?o.fire({title:"¿Guardar?",text:"Si no se captura el número de serie, se guardará como 'ILEGIBLE'",icon:"warning",showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar"}).then(n=>{n.isConfirmed?s(e,t):e.val(t.old_serial)}):t.serial!=t.old_serial&&s(e,t)}),$(".censo-status").on("change",function(){const e=$(this),t={point:e.data("point"),id:e.data("id"),old_status:e.data("status"),status:e.val()};i.post("/api/v1/Support/Branch-Inventory/UpdateStatus/"+t.id,{api_key,_method:"POST",status:t.status},function(n){n.code!=200?(o.fire({text:n.message,icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_status).trigger("change")):t.status==17?e.closest(".device-card").removeClass("border-danger"):e.closest(".device-card").addClass("border-danger")},function(){o.fire({text:"Ha ocurrido un error al intentar actualizar el estado del equipo. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_status).trigger("change")})}),$(".censo-feature-value-list").on("change",function(){const e=$(this),t={api_key,_method:"POST",id:e.data("id"),feature:e.data("feature"),old_value:e.data("value"),value:e.find("option:selected").text().trim()};t.value==""&&t.old_value==""||i.post("/api/v1/Support/Branch-Inventory/UpdateFeatureValue/"+t.id,t,function(n){n.code!=200&&o.fire({text:n.message,icon:"error",confirmButtonText:"Aceptar"})},function(){o.fire({text:"Ha ocurrido un error al intentar actualizar la característica del equipo. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"})})}),$(".device-accesories").on("blur",function(){const e=$(this),t={api_key,_method:"POST",id:e.data("id"),component:e.data("component"),old_quantity:parseInt(e.data("quantity")),quantity:parseInt(e.val())};t.quantity!=t.old_quantity&&i.post("/api/v1/Support/Branch-Inventory/UpdateAccesory/"+t.id,t,function(n){n.code!=200&&(o.fire({text:n.message,icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_quantity))},function(){o.fire({text:"Ha ocurrido un error al intentar actualizar la cantidad del accesorio. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_quantity)})});function s(e,t){i.post("/api/v1/Support/Branch-Inventory/UpdateSerial/"+t.id,{api_key,_method:"POST",serial:t.serial},function(n){n.code==200?(i.loading(),r(t.point,t.id)):(o.fire({text:n.message,icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_serial))},function(){o.fire({text:"Ha ocurrido un error al intentar actualizar el número de serie del equipo. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"}),e.val(t.old_serial)})}function r(e,t=null){let n=window.location.href;const a=new URL(n);a.search="",a.hash="";let v=a.toString()+"?point="+e+(t?"&device="+t:"");window.location.href=v}function f(e){if(e&&$("#device-card-"+e).length>0){const t=$("#device-card-"+e).offset().top-100;window.scrollTo({top:t,behavior:"smooth"})}}function m(){$(".censo-model-list").select2({theme:"bootstrap-5"}),$("#new-device-model").length>0&&$("#new-device-model").select2({theme:"bootstrap-5",dropdownParent:$("#branch-inventory-new-device-modal")})}c.initClic("#new-device-form-button",function(e){u(),l.show(),l.onhide(function(){u()}),c.initClic("#branch-inventory-new-device-button",function(t){if(d.form("#assign-box-form")){const n={api_key,_method:"PUT",model:$("#new-device-model").val(),serial:$("#new-device-serial").val(),status:$("#new-device-status").val(),service:$("#new-device-service").val(),area:$("#new-device-area").val(),point:$("#new-device-point").val()};i.post("/api/v1/Support/Branch-Inventory/"+n.service+"/"+n.area+"/"+n.point+"/Device",n,function(a){a.code==200?r(n.point,a.data.device):o.fire({text:a.message,icon:"error",confirmButtonText:"Aceptar"})},function(){o.fire({text:"Ha ocurrido un error al intentar registrar el nuevo equipo. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"})})}})});function u(){d.form_reset("#new-device-form"),$("#new-device-model").val("").trigger("change"),$("#new-device-serial").val(""),$("#new-device-status").val(17)}c.initClic(".censo-delete-device",function(e){o.fire({title:"¿Eliminar?",icon:"warning",showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",html:"¿Está seguro de eliminar el equipo?<br><strong>Esta acción no se puede deshacer</strong>"}).then(t=>{if(t.isConfirmed){const n={api_key,_method:"DELETE"};i.post("/api/v1/Support/Branch-Inventory/Device/"+e.data("id"),n,function(a){a.code==200?r(e.data("point")):o.fire({text:a.message,icon:"error",confirmButtonText:"Aceptar"})},function(){o.fire({text:"Ha ocurrido un error al intentar eliminar el equipo. Recargue la página e intente nuevamente.",icon:"error",confirmButtonText:"Aceptar"})})}})}),i.loaded()});
