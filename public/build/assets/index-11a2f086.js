import{A as M,E as q}from"./Events-fb55d1f4.js";import{T as N}from"./Table-f78b8306.js";import"./sweetalert2-374f0b4f.js";$(function(){const o=new q,n=new N,c=new M,p=document.querySelector("#acceptTransferDrawer .close-drawer-button"),b=new bootstrap.Offcanvas("#acceptTransferDrawer");document.getElementById("acceptTransferDrawer"),document.getElementById("acceptTransferForm");const i=document.getElementById("acceptTransferCodeForm"),v=document.getElementById("submitTransferCode-btn"),m=document.getElementById("resendCode-btn"),d=new bootstrap.Modal("#acceptDevicesModal",{keyboard:!1}),y=document.getElementById("acceptDevicesModal"),D=document.getElementById("acceptDevices-btn"),l=new bootstrap.Modal("#acceptDevicesCodeModal",{keyboard:!1}),g=document.getElementById("acceptDevicesCodeModal");let r;u();function u(){o.api("/api/v3/Logistic/Destinations","GET",{},{Authorization:"Bearer "+api_key},function(t){n.init("destinations-table",t.data.destinations,I(),B(),function(){E(),n.sortByColumn("destinations-table",3,"desc")},function(){})})}function w(t){switch(t.StatusId){case 68:case"68":return`
                <li class="my-2"><a role="button" class="table-action-accept-transfer dropdown-item fw-bold text-primary"><i class="bi bi-truck"></i> Recepcionar Equipos</a></li>
                `}}function I(){return[{data:"DistributionId",render:{_:function(e,a,s){return`
                        <div class="btn-group">
                            <button type="button" class="btn border-0" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-three-dots-vertical"></i>
                            </button>
                            <ul class="dropdown-menu">
                                `+w(s)+`
                            </ul>
                        </div>`}}},{data:"Project"},{data:"Customer"},{data:"Branch"},{data:"State"},{data:"Devices",render:{_:function(e,a,s){return'<span class="fs-6 fw-bold">'+e+"</span>"}}},{data:"Status",render:{_:function(e,a,s){return'<span class="fs-5 fw-bold">'+e+"</span>"}}},{data:"CurrentTransfer",render:{_:function(e,a,s){return e!==null?'<span class="fs-6 fw-bold">'+e+"</span>":""}}}]}function B(){return[{targets:["_all"],className:"align-middle"},{targets:[0,5,7],orderable:!1,className:"align-middle text-center"}]}function E(){h()}function h(){document.getElementById("destinations-table").addEventListener("click",function(t){if(t.target&&t.target.classList.contains("table-action-accept-transfer")){let e=n.rowData("destinations-table",t.target.closest("tr"));e!==void 0&&(o.loading(),d.show(),r={DistributionId:e.DistributionId,BranchId:e.BranchId,StatusId:e.StatusId,Devices:[]},T(e.DistributionId,e.BranchId,e.StatusId,e.CurrentTransfer))}})}y.addEventListener("hide.bs.modal",function(t){n.destroy("assigned-inventory-table"),n.destroy("accepted-inventory-table")});function T(t,e,a,s){o.api("/api/v3/Logistic/Distribution/Destination/Devices","GET",{DistributionId:t,BranchId:e,StatusId:a,TransferId:s},{Authorization:"Bearer "+api_key},function(S){n.init("assigned-inventory-table",S.inventory,L(),A(),function(){C()}),n.init("accepted-inventory-table",{},_(),k())})}function L(){return[{data:"Line",render:{_:function(e,a,s){return'<span class="fs-9 fw-bold">'+e+'</span><br><span class="fs-7 fw-bold">'+s.Subline+"</span>"},sort:function(e,a,s){return e}}},{data:"Model",render:{_:function(e,a,s){return'<span class="fs-9">'+s.Brand+'</span><br><span class="fs-7 fw-bold">'+e+"</span>"},sort:function(e,a,s){return e}}},{data:"Serial",render:{_:function(e,a,s){return'<span class="fs-6 fw-bold">'+e+"</span>"},sort:function(e,a,s){return e}}},{data:"Id",render:{_:function(e,a,s){return'<a role="button" class="fs-5"><i class="bi bi-arrow-right-square-fill acceptDevice-btn"></i></a>'}}}]}function _(){return[{data:"Id",render:{_:function(e,a,s){return'<a role="button" class="fs-5"><i class="bi bi-arrow-left-square-fill removeDevice-btn"></i></a>'}}},{data:"Line",render:{_:function(e,a,s){return'<span class="fs-7 fw-bold">'+e+"</span>"},sort:function(e,a,s){return e}}},{data:"Model",render:{_:function(e,a,s){return'<span class="fs-9">'+s.Brand+'</span><br><span class="fs-7 fw-bold">'+e+"</span>"},sort:function(e,a,s){return e}}},{data:"Serial",render:{_:function(e,a,s){return'<span class="fs-6 fw-bold">'+e+"</span>"},sort:function(e,a,s){return e}}}]}function A(){return[{targets:["_all"],className:"align-middle"},{targets:[3],className:"text-center"}]}function k(){return[{targets:["_all"],className:"align-middle"},{targets:[0],className:"text-center"}]}p.addEventListener("click",function(){b.hide()});function C(){document.getElementById("assigned-inventory-table").addEventListener("click",function(t){if(t.target&&t.target.classList.contains("acceptDevice-btn")){let e=n.rowData("assigned-inventory-table",t.target.closest("tr"));e!==void 0&&(n.addRow("accepted-inventory-table",e),n.removeRow("assigned-inventory-table",t.target.closest("tr")))}}),document.getElementById("accepted-inventory-table").addEventListener("click",function(t){if(t.target&&t.target.classList.contains("removeDevice-btn")){let e=n.rowData("accepted-inventory-table",t.target.closest("tr"));e!==void 0&&(n.addRow("assigned-inventory-table",e),n.removeRow("accepted-inventory-table",t.target.closest("tr")))}}),document.getElementById("acceptAllDevices-btn").addEventListener("click",function(t){n.allData("assigned-inventory-table").each(function(a){n.addRow("accepted-inventory-table",a)}),n.clear("assigned-inventory-table")}),document.getElementById("returnAllDevices-btn").addEventListener("click",function(t){n.allData("accepted-inventory-table").each(function(a){n.addRow("assigned-inventory-table",a)}),n.clear("accepted-inventory-table")})}D.addEventListener("click",function(){if(n.isEmpty("accepted-inventory-table")){c.toast("Debe seleccionar al menos un equipo para recepcionar.","error");return}if(n.isNotEmpty("assigned-inventory-table")){c.confirm("Existen equipos sin recepcionar. Todos los equipos que no sean recepcionados, regresaran al almacen de origen y se tendrá que realizar la asignación nuevamente. ¿Desea continuar?",function(){f()});return}f()});function f(){let t=n.allData("accepted-inventory-table");r.Devices=[],t.each(function(e){r.Devices.push(e.InventoryId)}),d.hide(),l.show()}g.addEventListener("hide.bs.modal",function(t){i.reset(),i.classList.remove("was-validated")}),v.addEventListener("click",function(t){i.dispatchEvent(new Event("submit"))}),i.addEventListener("submit",function(t){t.preventDefault(),t.stopPropagation(),i.classList.add("was-validated"),i.checkValidity()===!0&&o.api("/api/v3/Logistic/Distribution/Destination/AcceptDevices","POST",{DistributionId:r.DistributionId,BranchId:r.BranchId,Devices:r.Devices,TransferCode:document.getElementById("transfer_code").value,ProcessStatus:70},{Authorization:"Bearer "+api_key},function(e){c.toast(e.message,"success"),l.hide(),n.destroy("destinations-table"),n.destroy("assigned-inventory-table"),n.destroy("accepted-inventory-table"),u()})}),m.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),o.api("/api/v3/Warehouse/Distribution/TransferCode","POST",{DistributionId:r.DistributionId,BranchId:r.BranchId,Device:r.Devices[0]},{Authorization:"Bearer "+api_key},function(e){c.toast(e.message,"success")})})});
